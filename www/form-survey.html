<!DOCTYPE html>
<html>
    
    <head>
        
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <title>PLN Collection App</title>
        
        <!-- Bootstrap core CSS -->
    	<link href="includes/bootstrap/css/bootstrap.css" rel="stylesheet">
        
        <!-- Custom styles for main-page.html -->
    	<link href="includes/css/form-page.css" rel="stylesheet">
		<link href="includes/css/main-page.css" rel="stylesheet">
        <link href="includes/css/dialogs.css" rel="stylesheet">
        
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
          <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
        
    </head>
    
    <body>
    	
        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="#">Total IT - PLN Collection App</a>
                </div>
            </div>
        </nav>
        
        <div class="container">
			
			<p class="messages bg-primary" style="margin-bottom: 15px;">Data Counter</p>
			
			<div class="form-group">
				<label>Nama Counter</label>
				<input type="text" class="form-control" id="counter_name" name="counter_name" readonly />
			</div>
			
			<div class="form-group">
				<label>Alamat Counter</label>
				<textarea class="form-control" id="counter_addr" name="counter_addr" readonly></textarea>
			</div>
			
			<div class="form-group">
				<label>No. Telepon Counter</label>
				<input type="text" class="form-control" id="counter_telp" name="counter_telp" readonly />
			</div>
			
			<div class="form-group">
				<label>Nama Pemilik Counter</label>
				<input type="text" class="form-control" id="counter_owner" name="counter_owner" readonly />
			</div>
			
			<form id="form-survey" autocomplete="off">
				
				<p class="messages bg-primary" style="margin-top:15px; margin-bottom: 15px;">Data Setoran</p>
				<div class="form-group">
					<label>Jumlah Tagihan</label>
					<div class="input-group">
						<span class="input-group-addon">Rp.</span>
						<input type="text" class="form-control" id="counter_bills" name="counter_bills" readonly />
					</div>
				</div>
				
				<div class="form-group">
					<label>Masukkan Jumlah Setoran</label>
					<div class="input-group">
						<span class="input-group-addon">Rp.</span>
						<input type="text" class="form-control" id="jumlah_setor" name="jumlah_setor" required />
					</div>
				</div>
				
				<div class="form-group">
					<label>Catatan</label>
					<textarea class="form-control" id="sch_note" name="sch_note"></textarea>
				</div>
				
				<div class="form-group">
					<button type="submit" class="btn btn-default btn-success" id="button_tambah_data">SIMPAN</button>
					<button type="button" class="btn btn-warning btn-success" id="button_skip_data" onClick="skipTransaksi();">SKIP</button>
					<input type="hidden" class="form-control" id="schedule_id" name="schedule_id" readonly />
				</div>
				
			</form>
			
		</div>
		
		<div class="container">
            <hr />
            <button type="button" class="btn btn-default btn-lg btn-block bt-icon" onClick="window.location.href='main-page.html';">Main Page <span class="glyphicon glyphicon-chevron-right"></span></button>
			<button type="button" class="btn btn-default btn-lg btn-block bt-icon" onClick="window.location.href='list-jadwal.html';">List Jadwal <span class="glyphicon glyphicon-chevron-right"></span></button>
            <button type="button" class="btn btn-default btn-lg btn-block bt-icon" onClick="logout();">Sign Out <span class="glyphicon glyphicon-chevron-right"></span></button>
        </div>
        
        <!-- Dialogs -->
        <div class="modal fade" id="AppDialogs" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-labelledby="myDialogs" aria-hidden="true">
        	<div class="modal-dialog">
                <div class="modal-content">
                	<div class="modal-header">
                    	<h4 class="modal-title" id="myDialogs"></h4>
                    </div>
                    <div class="modal-body">
                        <p class="alert" id="myDialogsText"></p>
                    </div>
                    <div class="modal-footer" id="myDialogsFoot">
                    	<button type="button" class="btn btn-default" id="button-DialogYes"><span class="glyphicon glyphicon-ok"></span> Yes</button>
                        <button type="button" class="btn btn-default" id="button-DialogNo"><span class="glyphicon glyphicon-remove"></span> No</button>
                        <button type="button" class="btn btn-default" id="button-DialogClose"><span class="glyphicon glyphicon-remove"></span> Close</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- "Please Wait" Dialog -->
        <div class="modal fade" id="pleasewait" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-labelledby="myWaitingModal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                    	<h4 class="modal-title" id="myWaitingModal">Please wait...</h4>
                    	<div class="progress progress-striped active">
                            <div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <script src="cordova.js" type="text/javascript"></script>
        
		<script src="includes/js/jquery-1.11.0.min.js" type="text/javascript"></script>
        <script src="includes/js/jquery.validate.min.js" type="text/javascript"></script>
        <script src="includes/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        
        <script src="includes/js/func-closeApp.js"></script>
        <script src="includes/js/func-logout.js"></script>
        <script src="includes/js/func-sessionCheck.js"></script>
        
        <script src="includes/js/img-func-getUrlParameter.js"></script>
        <script src="includes/js/form-func-surveyPage.js"></script>
		
		<script>
			$('#form-survey').validate({
				rules: {
					jumlah_setor: {
						required: true,
						digits: true
					}
				},
				highlight: function(element) {
					$(element).closest('.form-group').addClass('has-error');
				},
				unhighlight: function(element) {
					$(element).closest('.form-group').removeClass('has-error');
				},
				errorElement: 'span',
				errorClass: 'help-block',
				errorPlacement: function(error, element) {
					if(element.parent('.input-group').length) {
						error.insertAfter(element.parent());
					} else {
						error.insertAfter(element);
					}
				},
				submitHandler: function(form){
					submitTransaksi();
				}
			});
			
			function submitTransaksi(){
				
				$("#pleasewait").modal();
				
				var	schedule_id		=	$("#schedule_id").val();
				var jumlah_setor	=	$("#jumlah_setor").val();
				var catatan			=	$("#sch_note").val();
				var stts			=	1;
				
				if(schedule_id != "" && jumlah_setor != ""){
					
					$.post(
						
						"http://totalit.co.id/demo/PLN-0.01/web-service/submit-dataSetor.php",
						{
							schedule_id		:	schedule_id,
							jumlah_setor	:	jumlah_setor,
							catatan			:	catatan,
							stts			:	stts
						},
						function(data){
							if(data['status'] == 1){
								$("#myDialogs").empty();
								$("#myDialogs").html("<div class=\"text-success\">Alert !</div>");
								
								$("#myDialogsText").removeClass("alert-success alert-info alert-warning alert-danger");
								$("#myDialogsText").addClass("alert-success");
								$("#myDialogsText").html(data['message']);
								
								$("#button-DialogYes").removeClass("btn-info btn-danger btn-warning btn-primary hide");
								$("#button-DialogNo").removeClass("hide");
								$("#button-DialogClose").removeClass("hide");
								
								$("#button-DialogYes").unbind();
								$("#button-DialogNo").unbind();
								$("#button-DialogClose").unbind();
								
								$("#button-DialogClose").bind("click", function(){
									$("#AppDialogs").modal("hide");
									setTimeout(
										function(){
											window.location.href="list-jadwal.html";
										},500
									);
								});
								
								$("#button-DialogYes").addClass("hide");
								$("#button-DialogNo").addClass("hide");
								
								$("#pleasewait").modal("hide");
								$("#AppDialogs").modal();	
							}else{
								$("#myDialogs").empty();
								$("#myDialogs").html("<div class=\"text-danger\">Alert !</div>");
								
								$("#myDialogsText").removeClass("alert-success alert-info alert-warning alert-danger");
								$("#myDialogsText").addClass("alert-danger");
								$("#myDialogsText").html(data['message']);
								
								$("#button-DialogYes").removeClass("btn-info btn-danger btn-warning btn-primary hide");
								$("#button-DialogNo").removeClass("hide");
								$("#button-DialogClose").removeClass("hide");
								
								$("#button-DialogYes").unbind();
								$("#button-DialogNo").unbind();
								$("#button-DialogClose").unbind();
								
								$("#button-DialogClose").bind("click", function(){
									$("#AppDialogs").modal("hide");
									setTimeout(
										function(){
											window.location.href="main-page.html";
										},500
									);
								});
								
								$("#button-DialogYes").addClass("hide");
								$("#button-DialogNo").addClass("hide");
								
								$("#pleasewait").modal("hide");
								$("#AppDialogs").modal();
							}
							
						},
						"json"
						
					);
					
				}else{
					$("#myDialogs").empty();
					$("#myDialogs").html("<div class=\"text-danger\">Alert !</div>");
					
					$("#myDialogsText").removeClass("alert-success alert-info alert-warning alert-danger");
					$("#myDialogsText").addClass("alert-danger");
					$("#myDialogsText").html("Terjadi Kesalahan, Harap Ulangi Proses.");
					
					$("#button-DialogYes").removeClass("btn-info btn-danger btn-warning btn-primary hide");
					$("#button-DialogNo").removeClass("hide");
					$("#button-DialogClose").removeClass("hide");
					
					$("#button-DialogYes").unbind();
					$("#button-DialogNo").unbind();
					$("#button-DialogClose").unbind();
					
					$("#button-DialogClose").bind("click", function(){
						$("#AppDialogs").modal("hide");
						setTimeout(
							function(){
								window.location.href="main-page.html";
							},500
						);
					});
					
					$("#button-DialogYes").addClass("hide");
					$("#button-DialogNo").addClass("hide");
					
					$("#pleasewait").modal("hide");
					$("#AppDialogs").modal();
				}
				
			}
			
			function skipTransaksi(){
				
				$("#pleasewait").modal();
				
				var	schedule_id		=	$("#schedule_id").val();
				var jumlah_setor	=	$("#jumlah_setor").val();
				var stts			=	2;
				
				if(schedule_id != ""){
					
					$.post(
						
						"http://totalit.co.id/demo/PLN-0.01/web-service/submit-dataSetor.php",
						{
							schedule_id		:	schedule_id,
							jumlah_setor	:	jumlah_setor,
							stts			:	stts
						},
						function(data){
							if(data['status'] == 1){
								$("#myDialogs").empty();
								$("#myDialogs").html("<div class=\"text-success\">Alert !</div>");
								
								$("#myDialogsText").removeClass("alert-success alert-info alert-warning alert-danger");
								$("#myDialogsText").addClass("alert-success");
								$("#myDialogsText").html(data['message']);
								
								$("#button-DialogYes").removeClass("btn-info btn-danger btn-warning btn-primary hide");
								$("#button-DialogNo").removeClass("hide");
								$("#button-DialogClose").removeClass("hide");
								
								$("#button-DialogYes").unbind();
								$("#button-DialogNo").unbind();
								$("#button-DialogClose").unbind();
								
								$("#button-DialogClose").bind("click", function(){
									$("#AppDialogs").modal("hide");
									setTimeout(
										function(){
											window.location.href="list-jadwal.html";
										},500
									);
								});
								
								$("#button-DialogYes").addClass("hide");
								$("#button-DialogNo").addClass("hide");
								
								$("#pleasewait").modal("hide");
								$("#AppDialogs").modal();	
							}else{
								$("#myDialogs").empty();
								$("#myDialogs").html("<div class=\"text-danger\">Alert !</div>");
								
								$("#myDialogsText").removeClass("alert-success alert-info alert-warning alert-danger");
								$("#myDialogsText").addClass("alert-danger");
								$("#myDialogsText").html(data['message']);
								
								$("#button-DialogYes").removeClass("btn-info btn-danger btn-warning btn-primary hide");
								$("#button-DialogNo").removeClass("hide");
								$("#button-DialogClose").removeClass("hide");
								
								$("#button-DialogYes").unbind();
								$("#button-DialogNo").unbind();
								$("#button-DialogClose").unbind();
								
								$("#button-DialogClose").bind("click", function(){
									$("#AppDialogs").modal("hide");
									setTimeout(
										function(){
											window.location.href="main-page.html";
										},500
									);
								});
								
								$("#button-DialogYes").addClass("hide");
								$("#button-DialogNo").addClass("hide");
								
								$("#pleasewait").modal("hide");
								$("#AppDialogs").modal();
							}
							
						},
						"json"
						
					);
					
				}
				
			}
		</script>
        
    </body>
    
</html>